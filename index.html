<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Buat Akun VPS & Pembayaran DANA</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@600;800&display=swap');

    :root {
      --color-bg: #ffffff;
      --color-text-primary: #111827;
      --color-text-secondary: #6b7280;
      --color-accent: #000000;
      --color-accent-hover: #333333;
      --color-border: #e5e7eb;
      --color-success: #16a34a;
      --color-error: #dc2626;
      --radius: 0.75rem;
      --shadow-light: 0 1px 4px rgba(0, 0, 0, 0.1);
      --transition-fast: 0.25s ease;
      --container-max-width: 1200px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background-color: var(--color-bg);
      color: var(--color-text-primary);
      line-height: 1.5;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
    }

    header {
      position: sticky;
      top: 0;
      width: 100%;
      background: var(--color-bg);
      border-bottom: 1px solid var(--color-border);
      box-shadow: var(--shadow-light);
      margin-bottom: 2rem;
      padding: 1rem 2rem;
      display: flex;
      justify-content: center;
      z-index: 1000;
    }

    .nav-container {
      max-width: var(--container-max-width);
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      color: var(--color-text-primary);
      font-weight: 800;
      font-size: 1.5rem;
      user-select: none;
    }

    nav ul {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      gap: 2rem;
      font-weight: 600;
    }

    nav ul li a {
      color: var(--color-text-secondary);
      text-decoration: none;
      font-size: 1rem;
      cursor: pointer;
      transition: color var(--transition-fast);
    }

    nav ul li a:hover,
    nav ul li a:focus {
      color: var(--color-accent);
      outline: none;
    }

    main {
      width: 100%;
      max-width: var(--container-max-width);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 3rem;
      padding: 0 1rem;
    }

    .hero {
      max-width: 700px;
      text-align: center;
      margin-bottom: 1rem;
    }

    .hero h1 {
      font-size: 3rem;
      font-weight: 800;
      margin-bottom: 0.5rem;
      line-height: 1.1;
      color: var(--color-text-primary);
    }

    .hero p {
      font-weight: 600;
      font-size: 1.125rem;
      color: var(--color-text-secondary);
      margin-top: 0;
    }

    form {
      background: #f9fafb;
      border-radius: var(--radius);
      box-shadow: var(--shadow-light);
      padding: 2rem 2.5rem;
      width: 100%;
      max-width: 440px;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      color: var(--color-text-primary);
    }

    label {
      font-weight: 600;
      font-size: 0.875rem;
      user-select: none;
    }

    input,
    select {
      font-family: inherit;
      font-size: 1rem;
      padding: 0.6rem 0.85rem;
      border-radius: var(--radius);
      border: 1.5px solid var(--color-border);
      color: var(--color-text-primary);
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
      width: 100%;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: var(--color-accent);
      box-shadow: 0 0 8px rgb(0 0 0 / 0.1);
    }

    button {
      margin-top: 1rem;
      padding: 0.75rem;
      font-size: 1.25rem;
      background-color: var(--color-accent);
      color: #fff;
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      font-weight: 700;
      box-shadow: var(--shadow-light);
      transition: background-color var(--transition-fast), transform var(--transition-fast);
      user-select: none;
    }

    button:disabled {
      background-color: var(--color-border);
      color: var(--color-text-secondary);
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    button:not(:disabled):hover,
    button:not(:disabled):focus {
      background-color: var(--color-accent-hover);
      transform: scale(1.05);
      outline: none;
    }

    .status-message {
      font-size: 1rem;
      font-weight: 600;
      padding: 0.75rem 1rem;
      border-radius: var(--radius);
      text-align: center;
      user-select: text;
    }

    .success {
      background-color: #dcfce7;
      border: 1px solid #4ade80;
      color: var(--color-success);
    }

    .error {
      background-color: #fee2e2;
      border: 1px solid #f87171;
      color: var(--color-error);
    }

    .payment-section {
      background: #f9fafb;
      border-radius: var(--radius);
      box-shadow: var(--shadow-light);
      padding: 2rem;
      max-width: 440px;
      width: 100%;
      display: none;
      flex-direction: column;
      gap: 1rem;
      color: var(--color-text-primary);
    }

    .payment-section.active {
      display: flex;
    }

    .payment-section h2 {
      margin: 0;
      font-weight: 800;
      font-size: 1.5rem;
      text-align: center;
    }

    .payment-instructions {
      font-size: 1rem;
      text-align: center;
      color: var(--color-text-secondary);
      user-select: text;
    }

    .account-details {
      font-family: monospace;
      background: #e5e7eb;
      padding: 1rem;
      border-radius: var(--radius);
      white-space: pre-wrap;
      user-select: text;
    }

    /* Responsive */
    @media (max-width: 480px) {
      .hero h1 {
        font-size: 2rem;
      }

      form,
      .payment-section {
        padding: 1.5rem 1.5rem;
        max-width: 100%;
      }

      button {
        font-size: 1.1rem;
        padding: 0.6rem;
      }
    }
  </style>
</head>

<body>
  <header>
    <div class="nav-container" role="navigation" aria-label="Navigasi utama">
      <div class="logo" tabindex="0">VPS Account Manager</div>
      <nav>
        <ul>
          <li><a href="#" tabindex="0">Beranda</a></li>
          <li><a href="#" tabindex="0">Cara Pakai</a></li>
          <li><a href="#" tabindex="0">Bantuan</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero" aria-label="Pengantar Aplikasi">
      <h1>Buat Akun VPS dan Bayar dengan DANA</h1>
      <p>Buat akun VPS Anda dulu, lalu lakukan pembayaran DANA untuk aktivasi. Setelah bayar, Anda akan melihat detail akun.</p>
    </section>

    <form id="createAccountForm" aria-label="Form Pembuatan Akun VPS">
      <label for="accountType">Jenis Akun</label>
      <select id="accountType" name="type" required aria-required="true">
        <option value="" disabled selected>Pilih jenis akun</option>
        <option value="trojan">Trojan</option>
        <option value="vmess">Vmess</option>
        <option value="vless">Vless</option>
        <option value="ssh">SSH</option>
      </select>

      <label for="username">Nama Pengguna</label>
      <input id="username" name="username" type="text" placeholder="Masukkan username" pattern="^[a-zA-Z0-9_]{3,20}$" required aria-required="true"/>

      <label for="duration">Durasi Aktif (Hari)</label>
      <input id="duration" name="durationDays" type="number" min="1" max="365" value="30" required aria-required="true"/>

      <label for="configs">Konfigurasi Tambahan (Opsional)</label>
      <input id="configs" name="configs" type="text" placeholder="Contoh: custom port, password" />

      <button type="submit">Buat Akun</button>
      <div id="formStatus" role="alert" aria-live="assertive"></div>
    </form>

    <section id="paymentSection" class="payment-section" aria-live="polite" aria-atomic="true" style="display:none;">
      <h2>Bayar Menggunakan DANA</h2>
      <div class="payment-instructions">
        Silakan scan kode QR DANA di bawah ini untuk pembayaran, atau transfer ke nomor berikut:<br />
        <strong>0822-2879-6979</strong>
      </div>
      <img src="https://i.ibb.co/0Z0LcFk/dana-qr-sample.png" alt="Kode QR Pembayaran DANA" style="width:180px; margin: 1rem auto;display:block;" />
      <button id="confirmPaymentBtn">Saya Sudah Bayar</button>
      <div id="paymentStatus"></div>
    </section>

    <section id="accountDetails" class="payment-section" aria-live="polite" aria-atomic="true" style="display:none;">
      <h2>Detail Akun Anda</h2>
      <pre class="account-details" id="accountInfo"></pre>
      <button id="createNewBtn">Buat Akun Baru</button>
    </section>
  </main>

  <script>
    (() => {
      'use strict';

      const API_BASE = 'https://152.42.227.218:3000/api';
      const AUTH_TOKEN = 'token-rahasia-anda'; // Ganti token dengan token backend

      const form = document.getElementById('createAccountForm');
      const formStatus = document.getElementById('formStatus');
      const paymentSection = document.getElementById('paymentSection');
      const paymentStatus = document.getElementById('paymentStatus');
      const confirmPaymentBtn = document.getElementById('confirmPaymentBtn');
      const accountDetailsSection = document.getElementById('accountDetails');
      const accountInfo = document.getElementById('accountInfo');
      const createNewBtn = document.getElementById('createNewBtn');

      let createdAccountData = null; // Simpan data akun yang dibuat

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        formStatus.textContent = '';
        formStatus.className = '';

        // Ambil data form
        const data = {
          type: form.accountType.value,
          username: form.username.value.trim(),
          durationDays: Number(form.duration.value),
          configs: form.configs.value.trim()
        };

        // Validasi form html sudah cukup, tapi cek kembali pengiriman
        if (!data.type || !data.username || !data.durationDays) {
          formStatus.textContent = 'Mohon lengkapi semua kolom yang wajib.';
          formStatus.className = 'error';
          return;
        }

        try {
          form.querySelector('button[type="submit"]').disabled = true;
          formStatus.textContent = 'Membuat akun...';

          const resp = await fetch(`${API_BASE}/create-account`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${AUTH_TOKEN}`
            },
            body: JSON.stringify(data)
          });

          if (!resp.ok) {
            const err = await resp.json().catch(() => ({}));
            throw new Error(err.message || 'Gagal membuat akun');
          }

          createdAccountData = await resp.json();
          form.style.display = 'none';
          paymentSection.style.display = 'flex';
          formStatus.textContent = '';
          paymentStatus.textContent = '';
        } catch (error) {
          formStatus.textContent = error.message;
          formStatus.className = 'error';
          form.querySelector('button[type="submit"]').disabled = false;
        }
      });

      confirmPaymentBtn.addEventListener('click', () => {
        paymentStatus.textContent = 'Memeriksa pembayaran...';
        // Simulasi delay pengecekan pembayaran, ganti dengan API pengecekan jika ada
        setTimeout(() => {
          // Untuk demo, anggap pembayaran berhasil
          paymentStatus.textContent = 'Pembayaran diterima, akun Anda aktif!';
          paymentStatus.className = 'success';
          paymentSection.style.display = 'none';
          accountDetailsSection.style.display = 'flex';
          displayAccountInfo();
        }, 2000);
      });

      function displayAccountInfo() {
        if (!createdAccountData) return;
        const account = createdAccountData.account || {};
        const infoLines = [
          `Jenis Akun : ${account.type || '-'}`,
          `Username   : ${account.username || '-'}`,
          `Durasi     : ${account.durationDays || '-'} hari`,
          `Konfigurasi Tambahan : ${account.configs || '-'}`,
          `Pesan     : ${createdAccountData.message || '-'}`,
        ];
        accountInfo.textContent = infoLines.join('\n');
      }

      createNewBtn.addEventListener('click', () => {
        createdAccountData = null;
        accountInfo.textContent = '';
        accountDetailsSection.style.display = 'none';
        form.style.display = 'flex';
        form.reset();
        form.querySelector('button[type="submit"]').disabled = false;
        formStatus.textContent = '';
        formStatus.className = '';
      });

    })();
  </script>
</body>

</html>
