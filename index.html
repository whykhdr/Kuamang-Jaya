<!DOCTYPE html>
<html>
<head>
    <title>Struk Thermal Kuitansi PAM</title>
    <meta charset="UTF-8">
    
    <style>
        /* CSS ini hanya berlaku saat perintah cetak dipicu */
        @media print {
            body {
                width: 58mm;
                font-family: Arial, sans-serif;
                font-size: 9pt;
                margin: 0;
                padding: 0;
                line-height: 1.2;
            }
            .container {
                width: 58mm;
                padding: 0 2mm; 
            }
            /* Styling Garis Pemisah */
            .separator-dashed { border-top: 1px dashed black; margin: 2px 0; }
            .separator-double { border-top: 3px double black; margin: 2px 0; }
            
            #print-btn { display: none; }
        }
        
        /* CSS untuk tampilan di layar (browser) */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .container {
            width: 58mm;
            border: 1px solid #ccc;
            padding: 10px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            background: white;
            margin: 0 auto;
        }
        .text-center { text-align: center; }
        .text-bold { font-weight: bold; }
        
        /* Styling Khusus Tabel untuk Alignment Titik Dua */
        .receipt-table {
            width: 100%;
            border-collapse: collapse;
        }
        .receipt-table td {
            padding: 0;
            vertical-align: top;
            white-space: nowrap; /* Mencegah pemisahan kata di tengah */
        }
        .td-label { width: 50%; text-align: left; }
        .td-colon { width: 5%; text-align: center; }
        .td-value { width: 45%; text-align: right; font-weight: bold; }
    </style>
</head>
<body>

    <button id="print-btn" onclick="window.print()">Cetak Kuitansi (Akan menyesuaikan ke 58mm)</button>
    <div class="container">
        <div id="receipt-output">
            Memuat data...
        </div>
    </div>

    <script>
        // PASTIKAN INI ADALAH URL JSON DARI SPREADSHEET ASLI ANDA
        const DATA_URL = 'https://docs.google.com/spreadsheets/d/1HHn6ZnqfLrEVNVktxIchcwdmBMmL-WyEnBBJP5piABg/gviz/tq?tqx=out:json&gid=651467196';

        function loadReceiptData() {
            fetch(DATA_URL)
                .then(res => res.text())
                .then(text => {
                    const jsonString = text.substring(47).slice(0, -2);
                    const data = JSON.parse(jsonString);
                    const rows = data.table.rows;
                    
                    if (rows.length < 18) {
                        document.getElementById('receipt-output').innerHTML = "Data kuitansi tidak lengkap.";
                        return;
                    }

                    // FUNGSI BANTU: Mengambil nilai kolom B (Indeks 1) dari baris JSON tertentu
                    const getVal = (rowIndex) => {
                        const cell = rows[rowIndex] ? rows[rowIndex].c[1] : null;
                        if (!cell) return 'N/A';
                        return cell.f || cell.v || 'N/A'; 
                    };

                    // EKSTRAKSI DATA BERDASARKAN INDEKS BARIS JSON (Sesuai Struktur Vertikal Anda)
                    const Tgl_Cetak = getVal(3);
                    const Periode_Bulan = getVal(4);
                    const Nama_Pelanggan = getVal(5);
                    const No_Pelanggan = getVal(6);
                    const Alamat_Rumah = getVal(7);
                    
                    const Stand_Awal = getVal(9);
                    const Stand_Akhir = getVal(10);
                    const Jumlah_Pemakaian = getVal(11);

                    const Tarif_Ixuan = getVal(13); 
                    const Pokok_Biaya = getVal(14); 

                    const Jumlah_Bayar = getVal(15); 
                    const Collector = getVal(17); 

                    // --- MERENDER HTML KUITANSI DENGAN TABEL UNTUK ALIGNMENT ---
                    const receiptHTML = `
                        <div class="text-center text-bold" style="font-size:10pt;">KWITANSI PEMBAYARAN AIR</div>
                        <div class="text-center text-bold" style="font-size:10pt;">PAMSIMAS TIRTA JAYA</div>
                        <div class="text-center text-bold" style="font-size:10pt;">DUSUN KUAMANG JAYA</div>
                        <div class="separator-dashed"></div>

                        <table class="receipt-table">
                            <tr><td class="td-label">Tgl. Cetak</td><td class="td-colon">:</td><td class="td-value" style="text-align: left;">${Tgl_Cetak}</td></tr>
                            <tr><td class="td-label">Periode Bulan</td><td class="td-colon">:</td><td class="td-value" style="text-align: left;">${Periode_Bulan}</td></tr>
                            <tr><td class="td-label">Nama Pelanggan</td><td class="td-colon">:</td><td class="td-value" style="text-align: left;">${Nama_Pelanggan}</td></tr>
                            <tr><td class="td-label">No Pelanggan</td><td class="td-colon">:</td><td class="td-value" style="text-align: left;">${No_Pelanggan}</td></tr>
                            <tr><td class="td-label">Alamat Rumah</td><td class="td-colon">:</td><td class="td-value" style="text-align: left;">${Alamat_Rumah}</td></tr>
                        </table>
                        <div class="separator-dashed"></div>

                        <div class="text-center text-bold">Rincian Pemakaian Air (M³)</div>
                        <table class="receipt-table">
                            <tr><td class="td-label">Stand Awal</td><td class="td-colon">:</td><td class="td-value">${Stand_Awal}</td></tr>
                            <tr><td class="td-label">Stand Akhir</td><td class="td-colon">:</td><td class="td-value">${Stand_Akhir}</td></tr>
                            <tr><td class="td-label">Jumlah Pemakai</td><td class="td-colon">:</td><td class="td-value">${Jumlah_Pemakaian}</td></tr>
                        </table>
                        <div class="separator-dashed"></div>

                        <div class="text-center text-bold">Rincian Biaya (Rp)</div>
                        <table class="receipt-table">
                            <tr><td class="td-label">Iuran 2.000/m³</td><td class="td-colon">:</td><td class="td-value">${Tarif_Ixuan}</td></tr>
                            <tr><td class="td-label">Pokok Beban</td><td class="td-colon">:</td><td class="td-value">${Pokok_Biaya}</td></tr>
                        </table>
                        <div class="separator-double"></div>
                        
                        <div class="text-bold" style="font-size: 11pt; text-align:center;">JUMLAH BAYAR</div>
                        <div class="text-center text-bold" style="font-size: 11pt;">${Jumlah_Bayar}</div>
                        <div class="separator-dashed"></div>
                        
                        <div class="text-center text-bold">TERIMA KASIH</div>
                        <div class="text-center">Collector: ${Collector}</div>
                    `;
                    
                    document.getElementById('receipt-output').innerHTML = receiptHTML;

                })
                .catch(error => {
                    document.getElementById('receipt-output').innerHTML = 'Gagal memuat data. Pastikan sheet dipublikasikan ke web dan link API benar.';
                    console.error('Error fetching data:', error);
                });
        }

        loadReceiptData();
    </script>
</body>
</html>
